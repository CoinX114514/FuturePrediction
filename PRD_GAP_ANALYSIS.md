# PRD 需求缺口分析文档

> 对比 PRD 文档与当前项目实现状态，梳理未满足的需求

## 📊 总体完成度

- **已完成功能**：约 40%
- **部分完成功能**：约 20%
- **未完成功能**：约 40%

---

## ✅ 已完成的核心功能

### 1. 用户认证系统 ✅
- [x] 手机号/邮箱登录
- [x] JWT Token 认证
- [x] 用户注册
- [x] 会话管理
- [x] 登出功能
- [ ] **缺失**：微信扫码登录
- [ ] **缺失**：找回密码功能

### 2. 权限管理系统 ✅
- [x] 用户角色（普通用户、会员、管理员）
- [x] 权限验证中间件
- [x] CSV 上传权限控制
- [x] 预测次数限制（普通用户 5 次/天，会员无限）
- [ ] **缺失**：会员升级功能
- [ ] **缺失**：支付系统（支付宝/微信支付）

### 3. 数据库设计 ✅
- [x] 用户表（users）
- [x] 会话表（user_sessions）
- [x] 期货合约表（futures_contracts）
- [x] 行情数据表（market_data）
- [x] 预测任务表（prediction_tasks）
- [x] 预测结果表（prediction_results）
- [x] 板块表（sectors）
- [x] 机会提醒表（opportunity_alerts）
- [x] 数据源配置表（data_sources）

### 4. CSV 上传与解析 ✅
- [x] CSV 文件上传接口
- [x] OHLCV 数据验证
- [x] 数据格式转换
- [x] 错误处理

### 5. K 线图显示 ✅
- [x] 蜡烛图（Candlestick Chart）
- [x] 成交量柱状图（独立显示）
- [x] 工具提示（Tooltip）
- [x] 日期格式化（Yahoo Finance 风格）
- [x] 支持 100+ 条数据加载
- [ ] **缺失**：多周期切换（目前仅日线）
- [ ] **缺失**：预测 K 线叠加显示

### 6. 板块榜单 ✅
- [x] 二级列表（板块 → 合约）
- [x] 权限控制（普通用户仅显示 3 个板块）
- [x] 涨跌幅排序
- [ ] **缺失**：实时数据更新（目前是 mock 数据）
- [ ] **缺失**：每 5 秒自动刷新

### 7. Docker 部署 ✅
- [x] 后端 Dockerfile
- [x] 前端 Dockerfile
- [x] Docker Compose 配置
- [x] 数据库初始化

---

## 🟡 部分完成的功能

### 1. Kronos 预测引擎 🟡
- [x] 预测接口框架
- [x] 预测任务表设计
- [x] 预测结果表设计
- [x] 权限和次数限制
- [ ] **缺失**：Kronos 模型实际集成
- [ ] **缺失**：多路径预测（目前仅单路径）
- [ ] **缺失**：置信区间计算
- [ ] **缺失**：概率分布输出
- [ ] **缺失**：预测结果可视化（叠加在 K 线图）

### 2. 实时行情模块 🟡
- [x] 前端 UI 组件
- [x] 价格信息卡片
- [ ] **缺失**：真实数据源接入（目前是 mock 数据）
- [ ] **缺失**：WebSocket 实时推送
- [ ] **缺失**：深度图实现
- [ ] **缺失**：成交明细实现

### 3. 基础信息栏 🟡
- [x] 合约信息组件（ContractInfo）
- [ ] **缺失**：持仓分析
- [ ] **缺失**：资金流向

---

## ❌ 未完成的功能

### 1. 登录界面功能 ❌
- [ ] 微信扫码登录
- [ ] 找回密码功能

### 2. 主界面功能 ❌
- [ ] 多周期 K 线切换（目前仅日线）
- [ ] 深度图实现
- [ ] 成交明细实现
- [ ] 板块热力图
- [ ] 异动提醒
- [ ] 预测 K 线叠加显示
- [ ] 准确率历史回测
- [ ] 信号强度指示器

### 3. 数据管理功能 ❌
- [ ] 自定义指标配置
- [ ] 历史数据回测

### 4. 账户权限体系功能 ❌
- [ ] 会员升级功能
- [ ] 支付系统（支付宝/微信支付 SDK）
- [ ] 自定义头像上传
- [ ] 数据源管理（管理员功能）
- [ ] 用户权限管理（管理员功能）

### 5. 技术架构功能 ❌
- [ ] **WebSocket 长连接**：实时行情推送
  - [ ] Socket.io 集成
  - [ ] 断线重连机制
  - [ ] 心跳检测
- [ ] **Redis 缓存**：热点数据缓存
- [ ] **Celery 异步任务队列**：预测任务异步处理
- [ ] **InfluxDB 时序数据库**：行情数据存储
- [ ] **GraphQL API**：目前是 REST API，PRD 要求 GraphQL
- [ ] **Nginx 配置**：反向代理和 WebSocket 支持

### 6. 数据源接入 ❌
- [ ] 期货行情数据 API 供应商选择
- [ ] 实时行情数据接入（新浪财经/东方财富/付费数据源）
- [ ] 数据同步机制

### 7. 机会提醒系统 ❌
- [ ] 机会提醒算法（突破/成交量激增/形态匹配）
- [ ] 推送服务（消息队列 + Push Gateway）
- [ ] 提醒级别管理

### 8. 预测功能增强 ❌
- [ ] 预测结果多路径显示（10 条路径）
- [ ] 置信区间可视化（上下界）
- [ ] 概率分布图表
- [ ] 预测结果叠加在 K 线图

---

## 📋 优先级分类

### P0（核心功能，必须实现）
1. **Kronos 模型集成** ⚠️
   - 当前状态：仅有占位符代码
   - 需要：实际模型文件、推理逻辑、多路径预测
2. **实时行情数据源接入** ⚠️
   - 当前状态：全部是 mock 数据
   - 需要：选择数据供应商、实现数据同步
3. **WebSocket 实时推送** ⚠️
   - 当前状态：未实现
   - 需要：Socket.io、断线重连、心跳检测

### P1（重要功能，尽快实现）
1. **预测结果可视化**
   - 预测 K 线叠加显示
   - 置信区间显示
   - 多路径概率分布
2. **会员升级与支付**
   - 支付系统集成
   - 会员升级流程
3. **深度图和成交明细**
   - 实时深度图
   - 成交明细列表

### P2（增强功能，后续迭代）
1. **多周期 K 线切换**
2. **自定义指标配置**
3. **历史数据回测**
4. **机会提醒系统**
5. **管理员功能**（数据源管理、用户权限管理）

---

## 🔧 技术债务

### 1. 架构差异
- **PRD 要求**：Node.js + GraphQL
- **当前实现**：Python FastAPI + REST API
- **建议**：评估是否需要迁移到 GraphQL，或保持 REST API

### 2. 数据存储
- **PRD 要求**：PostgreSQL + Redis + InfluxDB
- **当前实现**：PostgreSQL（已实现），Redis（未使用），InfluxDB（未实现）
- **建议**：先实现 Redis 缓存，InfluxDB 可后续添加

### 3. 异步任务
- **PRD 要求**：Celery 异步任务队列
- **当前实现**：同步处理
- **建议**：预测任务应改为异步，使用 Celery

---

## 📝 实施建议

### 第一阶段（1-2 周）
1. 完成 Kronos 模型集成
2. 接入实时行情数据源（至少一个）
3. 实现 WebSocket 实时推送基础功能

### 第二阶段（2-3 周）
1. 完善预测结果可视化
2. 实现深度图和成交明细
3. 集成支付系统（测试环境）

### 第三阶段（3-4 周）
1. 实现会员升级流程
2. 添加机会提醒系统
3. 完善管理员功能

### 第四阶段（持续优化）
1. 性能优化（Redis 缓存、数据库优化）
2. 添加 InfluxDB 时序数据库
3. 历史数据回测功能
4. 自定义指标配置

---

## 📊 功能完成度统计

| 模块 | 完成度 | 状态 |
|------|--------|------|
| 用户认证 | 80% | 🟡 缺少微信登录、找回密码 |
| 权限管理 | 70% | 🟡 缺少会员升级、支付 |
| 数据库设计 | 100% | ✅ 完成 |
| CSV 上传 | 100% | ✅ 完成 |
| K 线图 | 70% | 🟡 缺少多周期、预测叠加 |
| 板块榜单 | 60% | 🟡 缺少实时数据 |
| 预测引擎 | 30% | ❌ 模型未集成 |
| 实时行情 | 20% | ❌ 缺少数据源、WebSocket |
| 技术架构 | 40% | 🟡 缺少 Redis、Celery、InfluxDB |

---

## 🎯 下一步行动

1. **立即开始**：Kronos 模型集成（P0）
2. **并行进行**：实时行情数据源接入（P0）
3. **准备阶段**：WebSocket 实现方案设计（P0）
4. **后续跟进**：支付系统调研和集成（P1）

---

*最后更新：2025-01-XX*
*文档版本：v1.0*

